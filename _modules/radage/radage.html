<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html"><link rel="search" title="Search" href="../../search.html">

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>radage.radage - radage unknown documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">radage unknown documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <span class="sidebar-brand-text">radage unknown documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Package Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api/modules.html">Module Reference</a><input aria-label="Toggle navigation of Module Reference" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/radage.html">radage package</a><input aria-label="Toggle navigation of radage package" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/radage.helper.html">radage.helper module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/radage.plotting.html">radage.plotting module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/radage.radage.html">radage.radage module</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for radage.radage</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize_scalar</span><span class="p">,</span> <span class="n">root_scalar</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Ellipse</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;invalid value encountered in multiply&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.helper</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># in My</span>
<span class="n">l238</span> <span class="o">=</span> <span class="mf">1.55125e-10</span> <span class="o">*</span> <span class="mf">1e6</span>
<span class="n">l238_std</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">l238</span> <span class="o">*</span> <span class="mf">0.107</span> <span class="o">/</span> <span class="mi">100</span>  <span class="c1"># see Schoene 2014 pg. 359</span>
<span class="n">l235</span> <span class="o">=</span> <span class="mf">9.8485e-10</span> <span class="o">*</span> <span class="mf">1e6</span>
<span class="n">l235_std</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">l235</span> <span class="o">*</span> <span class="mf">0.137</span> <span class="o">/</span> <span class="mi">100</span>
<span class="n">l232</span> <span class="o">=</span> <span class="mf">0.049475e-9</span> <span class="o">*</span> <span class="mf">1e6</span>  <span class="c1"># probably needs to be updated, from Stacey and Kramers 1975</span>
<span class="n">u238u235</span> <span class="o">=</span> <span class="mf">138.818</span>  <span class="c1"># Heiss 2012</span>


<div class="viewcode-block" id="concordia">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.concordia">[docs]</a>
<span class="k">def</span> <span class="nf">concordia</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wetherill concordia curve.</span>

<span class="sd">    207/235 and 206/238 ratios for given times.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : array-like</span>
<span class="sd">        time points in Myr</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    r207_235 : array-like</span>
<span class="sd">        207/235 ratios for the given times</span>
<span class="sd">    r206_238 : array-like</span>
<span class="sd">        206/238 ratios for the given times</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r206_238</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">r207_235</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">r207_235</span><span class="p">,</span> <span class="n">r206_238</span></div>



<div class="viewcode-block" id="concordia_tw">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.concordia_tw">[docs]</a>
<span class="k">def</span> <span class="nf">concordia_tw</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tara-Wasserberg concordia curve.</span>

<span class="sd">    238/206 and 207/206 ratios for given times.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : array-like</span>
<span class="sd">        time points in Myr</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    r238_206 : array-like</span>
<span class="sd">        238/206 ratios for the given times</span>
<span class="sd">    r207_206 : array-like</span>
<span class="sd">        207/206 ratios for the given times</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r206_238</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">r238_206</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">r206_238</span>
    <span class="n">r207_206</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">u238u235</span>

    <span class="k">return</span> <span class="n">r238_206</span><span class="p">,</span> <span class="n">r207_206</span></div>



<div class="viewcode-block" id="concordia_confint">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.concordia_confint">[docs]</a>
<span class="k">def</span> <span class="nf">concordia_confint</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Confidence intervals on concordia.</span>

<span class="sd">    Function giving 206/238, 207/235 ratios for bounds on confidence region around concordia at a given t</span>
<span class="sd">    Returns upper bound, then lower bound</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : array-like</span>
<span class="sd">        time points in Myr</span>
<span class="sd">    conf : float, optional</span>
<span class="sd">        confidence level for interval, defaults to 0.95</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lower_bound : numpy.ndarray</span>
<span class="sd">        Lower bound of confidence interval, first column is 207/235, second column is 206/238</span>
<span class="sd">    upper_bound : numpy.ndarray</span>
<span class="sd">        Upper bound of confidence interval, first column is 207/235, second column is 206/238</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># slope of line tangent to concordia</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span>

    <span class="c1"># rename coordinates (207/235 = x, 206/238 = y)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">concordia</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="c1"># uncertainty ellipse for given confidence interval</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># uncertainties in x, y at given time t</span>
    <span class="n">sigy</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">l238_std</span>
    <span class="n">sigx</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">l235_std</span>

    <span class="c1"># tangent points to uncertainty ellipse</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="n">ytan_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span>
                              <span class="p">(</span><span class="o">-</span><span class="n">m</span> <span class="o">*</span> <span class="n">sigx</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">sigy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">sigy</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">y</span>
        <span class="n">xtan_1</span> <span class="o">=</span> <span class="o">-</span><span class="n">m</span> <span class="o">*</span> <span class="n">sigx</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">sigy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ytan_1</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span>

        <span class="n">ytan_2</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span>
                               <span class="p">(</span><span class="o">-</span><span class="n">m</span> <span class="o">*</span> <span class="n">sigx</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">sigy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">sigy</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">y</span>
        <span class="n">xtan_2</span> <span class="o">=</span> <span class="o">-</span><span class="n">m</span> <span class="o">*</span> <span class="n">sigx</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">sigy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ytan_2</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">xtan_1</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ytan_1</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">xtan_2</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ytan_2</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">xtan_1</span><span class="p">,</span> <span class="n">ytan_1</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">xtan_2</span><span class="p">,</span> <span class="n">ytan_2</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

    <span class="k">return</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span></div>


<div class="viewcode-block" id="r206_238">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.r206_238">[docs]</a>
<span class="k">def</span> <span class="nf">r206_238</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;206/238 ratio for given time.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : float or numpy.ndarray</span>
<span class="sd">        Time in Myr</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    r206_238 : float or numpy.ndarray</span>
<span class="sd">        206/238 ratio for the given time(s)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r206_238</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">r206_238</span></div>


<div class="viewcode-block" id="r207_235">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.r207_235">[docs]</a>
<span class="k">def</span> <span class="nf">r207_235</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;207/235 ratio for given time.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : float or numpy.ndarray</span>
<span class="sd">        Time in Myr</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    r207_235 : float or numpy.ndarray</span>
<span class="sd">        207/235 ratio for the given time(s)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r207_235</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">r207_235</span></div>


<div class="viewcode-block" id="r207_206">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.r207_206">[docs]</a>
<span class="k">def</span> <span class="nf">r207_206</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u238u235</span><span class="o">=</span><span class="n">u238u235</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;207/206 ratio for given time.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : float or numpy.ndarray</span>
<span class="sd">        Time in Myr</span>
<span class="sd">    u238u235 : float, optional</span>
<span class="sd">        Ratio of U238 to U235, by default 138.818</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    r207_206 : float or numpy.ndarray</span>
<span class="sd">        207/206 ratio for the given time(s)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r207_206</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">u238u235</span>
    <span class="k">return</span> <span class="n">r207_206</span></div>


<div class="viewcode-block" id="t238">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.t238">[docs]</a>
<span class="k">def</span> <span class="nf">t238</span><span class="p">(</span><span class="n">r206_238</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;206/238 date</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r206_238 : float or numpy.ndarray</span>
<span class="sd">        206/238 ratio</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    t: float</span>
<span class="sd">        Date in Myr</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r206_238</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">l238</span>
    <span class="k">return</span> <span class="n">t</span></div>



<div class="viewcode-block" id="t235">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.t235">[docs]</a>
<span class="k">def</span> <span class="nf">t235</span><span class="p">(</span><span class="n">r207_235</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;207/235 date</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r207_235 : float or numpy.ndarray</span>
<span class="sd">        207/235 ratio</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    t: float</span>
<span class="sd">        Date in Myr</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r207_235</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">l235</span>
    <span class="k">return</span> <span class="n">t</span></div>



<div class="viewcode-block" id="t207">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.t207">[docs]</a>
<span class="k">def</span> <span class="nf">t207</span><span class="p">(</span><span class="n">r207_206</span><span class="p">,</span> <span class="n">u238u235</span><span class="o">=</span><span class="n">u238u235</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;207/206 date</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r207_206 : float or numpy.ndarray</span>
<span class="sd">        207/206 ratio(s)</span>
<span class="sd">    u238u235 : float, optional</span>
<span class="sd">        Ratio of U238 to U235, by default u238u235</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    date: float</span>
<span class="sd">        Date in Myr</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ignore warning that occurs sometimes during optimization</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
        <span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;invalid value encountered in double_scalars&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cost</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">cur207_206</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        cost function for solving for t</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">S</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">u238u235</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span>
             <span class="n">cur207_206</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">S</span>

    <span class="c1"># compute date</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">minimize_scalar</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">r207_206</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5000</span><span class="p">))</span><span class="o">.</span><span class="n">x</span>

    <span class="k">return</span> <span class="n">date</span></div>



<div class="viewcode-block" id="UPb">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.UPb">[docs]</a>
<span class="k">class</span> <span class="nc">UPb</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    class for handling U-Pb ages, where data are given as isotopic ratios and their uncertainties</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r206_238 : float</span>
<span class="sd">        Pb206/U238 ratio</span>
<span class="sd">    r206_238_std : float</span>
<span class="sd">        Standard deviation of Pb206/U238 ratio</span>
<span class="sd">    r207_235 : float</span>
<span class="sd">        Pb207/U235 ratio</span>
<span class="sd">    r207_235_std : float</span>
<span class="sd">        Standard deviation of Pb207/U235 ratio</span>
<span class="sd">    r207_206 : float</span>
<span class="sd">        Pb207/Pb206 ratio</span>
<span class="sd">    r207_206_std : float</span>
<span class="sd">        Standard deviation of Pb207/Pb206 ratio</span>
<span class="sd">    rho75_68 : float</span>
<span class="sd">        Error correlation between 207/235 and 206/238 ratios. Must be between -1 and 1</span>
<span class="sd">    rho86_76 : float</span>
<span class="sd">        Error correlation between 238/206 and 207/206 ratios. Must be between -1 and 1</span>
<span class="sd">    name : str, optional</span>
<span class="sd">        Name for age, by default None. Useful for plotting</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    cov_235_238 : numpy.ndarray</span>
<span class="sd">        Covariance matrix for 206/238 and 207/235 ratios</span>
<span class="sd">    eigval_235_238 : numpy.ndarray</span>
<span class="sd">        Eigenvalues of covariance matrix for 206/238 and 207/235 ratios</span>
<span class="sd">    eigvec_235_238 : numpy.ndarray</span>
<span class="sd">        Eigenvectors of covariance matrix for 206/238 and 207/235 ratios</span>
<span class="sd">    cov_238_207 : numpy.ndarray</span>
<span class="sd">        Covariance matrix for 238/206 and 207/206 ratios</span>
<span class="sd">    eigval_238_207 : numpy.ndarray</span>
<span class="sd">        Eigenvalues of covariance matrix for 238/206 and 207/206 ratios</span>
<span class="sd">    eigvec_238_207 : numpy.ndarray</span>
<span class="sd">        Eigenvectors of covariance matrix for 238/206 and 207/206 ratios</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">r206_238</span><span class="p">,</span> <span class="n">r206_238_std</span><span class="p">,</span>
                 <span class="n">r207_235</span><span class="p">,</span> <span class="n">r207_235_std</span><span class="p">,</span>
                 <span class="n">r207_206</span><span class="p">,</span> <span class="n">r207_206_std</span><span class="p">,</span>
                 <span class="n">rho75_68</span><span class="p">,</span> <span class="n">rho86_76</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create UPb object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r206_238</span> <span class="o">=</span> <span class="n">r206_238</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r206_238_std</span> <span class="o">=</span> <span class="n">r206_238_std</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r207_235</span> <span class="o">=</span> <span class="n">r207_235</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r207_235_std</span> <span class="o">=</span> <span class="n">r207_235_std</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r207_206</span> <span class="o">=</span> <span class="n">r207_206</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r207_206_std</span> <span class="o">=</span> <span class="n">r207_206_std</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r238_206</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">r206_238</span>

        <span class="c1"># check that correlation coefficients are between 0 and 1</span>
        <span class="k">if</span> <span class="n">rho75_68</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">rho75_68</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;rho75_68 must be between -1 and 1&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rho86_76</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">rho86_76</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">rho86_76</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;rho86_76 must be between -1 and 1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho75_68</span> <span class="o">=</span> <span class="n">rho75_68</span>  <span class="c1"># rho1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho86_76</span> <span class="o">=</span> <span class="n">rho86_76</span>  <span class="c1"># rho2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1"># compute eigen decomposition of covariance matrix for 206/238, 207/235</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cov_235_238</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r207_235_std</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rho75_68</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238_std</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r207_235_std</span>
            <span class="p">],</span>
                <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rho75_68</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238_std</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r207_235_std</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r206_238_std</span><span class="o">**</span><span class="mi">2</span>
            <span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eigval_235_238</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigvec_235_238</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cov_235_238</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigval_235_238</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># sort descending</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eigval_235_238</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigval_235_238</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eigvec_235_238</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigvec_235_238</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># compute eigen decomposition of covariance matrix for 238/206, 207/206</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r238_206_std</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r206_238_std</span> <span class="o">/</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">r206_238</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r238_206</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cov_238_207</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r238_206_std</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rho86_76</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r238_206_std</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r207_206_std</span>
            <span class="p">],</span>
                <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rho86_76</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r238_206_std</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r207_206_std</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r207_206_std</span><span class="o">**</span><span class="mi">2</span>
            <span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eigval_238_207</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigvec_238_207</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cov_238_207</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigval_238_207</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># sort descending</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eigval_238_207</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigval_238_207</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eigvec_238_207</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigvec_238_207</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>

<div class="viewcode-block" id="UPb.ellipse_68_75">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.UPb.ellipse_68_75">[docs]</a>
    <span class="k">def</span> <span class="nf">ellipse_68_75</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">conf</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
                      <span class="n">patch_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Uncertainty ellipse for 206Pb/238U-207Pb/235U date</span>

<span class="sd">        See `here &lt;https://en.wikipedia.org/wiki/Multivariate_normal_distribution#Interval&gt;`__ for more information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        conf : float, optional</span>
<span class="sd">            Confidence level for interval, by default 0.95</span>
<span class="sd">        patch_dict : dict, optional</span>
<span class="sd">            Dictionary of keyword arguments for the ellipse, by default None. If None, a default style is used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ell : matplotlib.patches.Ellipse</span>
<span class="sd">            Ellipse object representing the uncertainty ellipse for the 206Pb/238U-207Pb/235U date.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set up a default stle</span>
        <span class="n">patch_dict</span> <span class="o">=</span> <span class="n">patch_dict_validator</span><span class="p">(</span><span class="n">patch_dict</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigval_235_238</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigval_235_238</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>

        <span class="c1"># compute rotation from primary eigenvector</span>
        <span class="n">rotdeg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigvec_235_238</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>

        <span class="c1"># create</span>
        <span class="n">ell</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">r207_235</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238</span><span class="p">),</span>
                      <span class="n">width</span><span class="o">=</span><span class="n">a1</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                      <span class="n">height</span><span class="o">=</span><span class="n">a2</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                      <span class="n">angle</span><span class="o">=</span><span class="n">rotdeg</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">patch_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">ell</span></div>


<div class="viewcode-block" id="UPb.ellipse_76_86">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.UPb.ellipse_76_86">[docs]</a>
    <span class="k">def</span> <span class="nf">ellipse_76_86</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">conf</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
                      <span class="n">patch_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Uncertainty ellipse for 207Pb/206Pb-238U/206Pb date</span>

<span class="sd">        See `here &lt;https://en.wikipedia.org/wiki/Multivariate_normal_distribution#Interval&gt;`__ for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set up a default stle</span>
        <span class="n">patch_dict</span> <span class="o">=</span> <span class="n">patch_dict_validator</span><span class="p">(</span><span class="n">patch_dict</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigval_238_207</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigval_238_207</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>

        <span class="c1"># compute rotation from primary eigenvector</span>
        <span class="n">rotdeg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigvec_238_207</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>

        <span class="c1"># create</span>
        <span class="n">ell</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">r238_206</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r207_206</span><span class="p">),</span>
                      <span class="n">width</span><span class="o">=</span><span class="n">a1</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                      <span class="n">height</span><span class="o">=</span><span class="n">a2</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                      <span class="n">angle</span><span class="o">=-</span><span class="n">rotdeg</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">patch_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">ell</span></div>


<div class="viewcode-block" id="UPb.discordance">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.UPb.discordance">[docs]</a>
    <span class="k">def</span> <span class="nf">discordance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;concordia-distance&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Date discordance.</span>

<span class="sd">        Compute discordance according to a given method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        method : str, optional</span>
<span class="sd">            Method for computing discordance, by default &#39;relative&#39;. Valid strings are:</span>

<span class="sd">            - &#39;SK&#39;: mixture model with Stacey and Kramers&#39; (1975) common lead model</span>
<span class="sd">            - &#39;p_238_235&#39;: use the probability of fit from the concordia age</span>
<span class="sd">            - &#39;relative&#39;: relative age different, where the 206/238 vs 207/235 ages are</span>
<span class="sd">                used for 206/238 ages younger than 1 Ga, and the 207/206 vs 206/238</span>
<span class="sd">                ages are used for ages older than 1 Ga</span>
<span class="sd">            - &#39;relative_68_76&#39;: relative age difference using only the 206/238 and 206/207</span>
<span class="sd">                ages, computed as 1-(t68/t76)</span>
<span class="sd">            - &#39;concordia-distance&#39;: as defined in Equation 8 of `Vermeesch (2021) &lt;http://doi.org/10.5194/gchron-3-247-2021&gt;`__ (see corrigendum).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        d : float</span>
<span class="sd">            discordance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;SK&#39;</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Pb_mix_t</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r207_206</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238</span><span class="p">)</span>
            <span class="n">r238_206_rad</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># r207_206_rad = 1/u238u235 * (np.exp(l235*t)-1)/(np.exp(l238*t)-1)</span>
            <span class="c1"># r207_206_cm = sk_pb(t)[1]/sk_pb(t)[0]</span>
            <span class="c1"># L = np.sqrt((r207_206_rad-r207_206_cm)**2 + (r238_206_rad)**2)</span>
            <span class="c1"># l = np.sqrt((1/self.r206_238-r238_206_rad)**2 + (self.r207_206-r207_206_rad)**2)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238</span><span class="p">)</span> <span class="o">/</span> <span class="n">r238_206_rad</span>
            <span class="c1"># d = l/L</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;relative&#39;</span><span class="p">:</span>
            <span class="n">cur68_age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date68</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="c1"># use 75 vs 68 for younger than 1 Ga</span>
            <span class="k">if</span> <span class="n">cur68_age</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cur68_age</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">date75</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cur68_age</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">date76</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;concordia-distance&#39;</span><span class="p">:</span>
            <span class="n">tc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_207_238_concordia</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">R68tc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">tc</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">R75tc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">tc</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r238_206</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">R68tc</span><span class="p">))</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r207_206</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">u238u235</span><span class="p">)</span><span class="o">*</span><span class="n">R75tc</span><span class="o">/</span><span class="n">R68tc</span><span class="p">))</span>
            <span class="n">d</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;relative_76_68&#39;</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">date68</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">date76</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;absolute_76_68&#39;</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date76</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">date68</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;relative_68_75&#39;</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">date68</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">date75</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;absolute_68_75&#39;</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date75</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">date68</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;p_68_75&#39;</span><span class="p">:</span>
            <span class="n">tc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_235_238_concordia</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r207_235</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">tc</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r206_238</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">tc</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">]])</span><span class="o">.</span><span class="n">T</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r207_235_std</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rho75_68</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r207_235_std</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238_std</span>
            <span class="p">],</span>
                <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rho75_68</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r207_235_std</span> <span class="o">*</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r206_238_std</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238_std</span><span class="o">**</span><span class="mi">2</span>
            <span class="p">]])</span>
            <span class="c1"># chi-squared statistic is this quadratic</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">C</span><span class="p">),</span> <span class="n">v</span><span class="p">))</span>
            <span class="c1"># probability of exceeding the statistic is just 1-cdf for a chi-squared distribution with 2 dof</span>
            <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">d</span><span class="p">)[()]</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;aitchison_76_68&#39;</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">dx</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r206_238</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">dy</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r207_206</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">u238u235</span> <span class="o">*</span>
                                                      <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span>
                                                      <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

            <span class="n">d</span> <span class="o">=</span> <span class="n">dx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date76</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span>
                    <span class="n">dy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date68</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span> <span class="o">/</span> <span class="n">dx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date76</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;aitchison_68_75&#39;</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">dx</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r207_235</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">dy</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r206_238</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">d</span> <span class="o">=</span> <span class="n">dx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date68</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span>
                    <span class="n">dy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date75</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span> <span class="o">/</span> <span class="n">dx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date68</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">))))</span>

        <span class="k">return</span> <span class="n">d</span></div>


<div class="viewcode-block" id="UPb.date_207_238_concordia">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.UPb.date_207_238_concordia">[docs]</a>
    <span class="k">def</span> <span class="nf">date_207_238_concordia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;207Pb/206Pb - 206Pb/238U concordia date </span>
<span class="sd">        </span>
<span class="sd">        The date is calculate as per `Ludwig (1998) &lt;http://doi.org/10.1016/S0016-7037(98)00059-3&gt;`__, with uncertainty and MSWD.</span>

<span class="sd">        Utilizes the error transformation for 207Pb/235U computed from 206Pb/238U and 207Pb/206Pb as per Appendix A of Ludwig (1998).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        t: float</span>
<span class="sd">            Concordia date (Myr) for 207Pb/206Pb - 206Pb/238U</span>
<span class="sd">        t_std: float</span>
<span class="sd">            Standard deviation of age</span>
<span class="sd">        poc: float</span>
<span class="sd">            Probability of concordance. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># relative errors</span>
        <span class="n">SX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238_std</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238</span>
        <span class="n">SY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r207_206_std</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">r207_206</span>
        <span class="c1"># Sx = self.r207_235_std / self.r207_235</span>
        <span class="n">Sy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238_std</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238</span>
        <span class="n">rhoXY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho86_76</span>
        <span class="c1"># error transformation for 207/235 computed from 206/238 and 207/206</span>
        <span class="n">Sx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">SX</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">SY</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">SX</span> <span class="o">*</span> <span class="n">SY</span> <span class="o">*</span> <span class="n">rhoXY</span><span class="p">)</span>
        <span class="n">rhoxy</span> <span class="o">=</span> <span class="p">(</span><span class="n">SX</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SX</span> <span class="o">*</span> <span class="n">SY</span> <span class="o">*</span> <span class="n">rhoXY</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Sx</span> <span class="o">*</span> <span class="n">Sy</span><span class="p">)</span>
        <span class="c1"># 207/235 computed from 206/238 and 207/206</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r207_206</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238</span> <span class="o">*</span> <span class="n">u238u235</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238</span>
        <span class="n">sigx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">Sx</span>
        <span class="n">sigy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238_std</span>

        <span class="c1"># get omega for a given t</span>
        <span class="k">def</span> <span class="nf">get_omega</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function uses the error transformations in Appendix A of Ludwig (1998)</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">Px</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
            <span class="n">Py</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>

            <span class="n">cov_mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[[</span><span class="n">sigx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Px</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">l235_std</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">rhoxy</span> <span class="o">*</span> <span class="n">sigx</span> <span class="o">*</span> <span class="n">sigy</span><span class="p">],</span>
                 <span class="p">[</span><span class="n">rhoxy</span> <span class="o">*</span> <span class="n">sigx</span> <span class="o">*</span> <span class="n">sigy</span><span class="p">,</span> <span class="n">sigy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Py</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">l238_std</span><span class="o">**</span><span class="mi">2</span><span class="p">]])</span>
            <span class="n">omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cov_mod</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">omega</span>

        <span class="k">def</span> <span class="nf">S_cost</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="n">omega</span> <span class="o">=</span> <span class="n">get_omega</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="n">R</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">S</span> <span class="o">=</span> <span class="n">omega</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">R</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">omega</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">R</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">omega</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">S</span>

        <span class="n">opt</span> <span class="o">=</span> <span class="n">minimize_scalar</span><span class="p">(</span><span class="n">S_cost</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5000</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bounded&#39;</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">x</span>

        <span class="n">omega</span> <span class="o">=</span> <span class="n">get_omega</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="n">Q235</span> <span class="o">=</span> <span class="n">l235</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">Q238</span> <span class="o">=</span> <span class="n">l238</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>

        <span class="n">t_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Q235</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Q238</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                         <span class="mi">2</span> <span class="o">*</span> <span class="n">Q235</span> <span class="o">*</span> <span class="n">Q238</span> <span class="o">*</span> <span class="n">omega</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># probability of concordance</span>
        <span class="n">poc</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="n">t_std</span><span class="p">,</span> <span class="n">poc</span></div>


<div class="viewcode-block" id="UPb.date_235_238_concordia">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.UPb.date_235_238_concordia">[docs]</a>
    <span class="k">def</span> <span class="nf">date_235_238_concordia</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;207Pb/235U - 206Pb/238U concordia date </span>
<span class="sd">        </span>
<span class="sd">        The date is calculate as per `Ludwig (1998) &lt;http://doi.org/10.1016/S0016-7037(98)00059-3&gt;`__, with uncertainty and MSWD.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        t : float</span>
<span class="sd">            Concordia date (Myr) for 207Pb/235U - 206Pb/238U</span>
<span class="sd">        t_std : float</span>
<span class="sd">            Standard deviation of age</span>
<span class="sd">        poc : float</span>
<span class="sd">            Probability of concordance.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get omega for a given t</span>
        <span class="k">def</span> <span class="nf">get_omega</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="n">P235</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
            <span class="n">P238</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>

            <span class="n">cov_mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">r207_235_std</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">P235</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">l235_std</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rho75_68</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238_std</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r207_235_std</span>
                <span class="p">],</span>
                    <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rho75_68</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238_std</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r207_235_std</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">r206_238_std</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">P238</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">l238_std</span><span class="o">**</span><span class="mi">2</span>
                <span class="p">]])</span>
            <span class="n">omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cov_mod</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">omega</span>

        <span class="c1"># cost function for concordia from Ludwig 1998, using their notation</span>
        <span class="k">def</span> <span class="nf">S_cost</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="n">omega</span> <span class="o">=</span> <span class="n">get_omega</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r207_235</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">S</span> <span class="o">=</span> <span class="n">omega</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">R</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">omega</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">R</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">omega</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">S</span>

        <span class="n">opt</span> <span class="o">=</span> <span class="n">minimize_scalar</span><span class="p">(</span><span class="n">S_cost</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5000</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bounded&#39;</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">x</span>

        <span class="n">omega</span> <span class="o">=</span> <span class="n">get_omega</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="n">Q235</span> <span class="o">=</span> <span class="n">l235</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">Q238</span> <span class="o">=</span> <span class="n">l238</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>

        <span class="n">t_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Q235</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Q238</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                         <span class="mi">2</span> <span class="o">*</span> <span class="n">Q235</span> <span class="o">*</span> <span class="n">Q238</span> <span class="o">*</span> <span class="n">omega</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># probability of concordance</span>
        <span class="n">poc</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="n">t_std</span><span class="p">,</span> <span class="n">poc</span></div>


<div class="viewcode-block" id="UPb.date68">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.UPb.date68">[docs]</a>
    <span class="k">def</span> <span class="nf">date68</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;206/238 date with uncertainty.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        conf : float or None, optional</span>
<span class="sd">            Confidence level for interval, by default 0.95. If None, only the age is returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        date : float</span>
<span class="sd">            Date in Myr</span>
<span class="sd">        sig : float</span>
<span class="sd">            Standard deviation of date</span>
<span class="sd">        confint : float</span>
<span class="sd">            Confidence interval at desired confidence level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">t238</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r206_238</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">conf</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">date</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">l238</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r206_238_std</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r206_238</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">conf</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">confint</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">sig</span><span class="p">)</span> <span class="o">-</span> <span class="n">date</span>
            <span class="k">return</span> <span class="n">date</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">confint</span></div>


<div class="viewcode-block" id="UPb.date75">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.UPb.date75">[docs]</a>
    <span class="k">def</span> <span class="nf">date75</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;207/235 date with uncertainty.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        conf : float or None, optional</span>
<span class="sd">            Confidence level for interval, by default 0.95. If None, only the age is returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        date : float</span>
<span class="sd">            Date in Myr</span>
<span class="sd">        sig : float</span>
<span class="sd">            Standard deviation of date</span>
<span class="sd">        confint : float</span>
<span class="sd">            Confidence interval at desired confidence level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">t235</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r207_235</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">conf</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">date</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">l235</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">r207_235_std</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r207_235</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">conf</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">confint</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">sig</span><span class="p">)</span> <span class="o">-</span> <span class="n">date</span>
            <span class="k">return</span> <span class="n">date</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">confint</span></div>


<div class="viewcode-block" id="UPb.date76">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.UPb.date76">[docs]</a>
    <span class="k">def</span> <span class="nf">date76</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">u238u235</span><span class="o">=</span><span class="n">u238u235</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;207/206 date with uncertainty.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        conf : float or None, optional</span>
<span class="sd">            Confidence level for interval, by default 0.95. If None, only the age is returned.</span>
<span class="sd">        u238u235 : float, optional</span>
<span class="sd">            Ratio of U238 to U235, by default u238u235</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        date : float</span>
<span class="sd">            Date in Myr</span>
<span class="sd">        sig : float</span>
<span class="sd">            Standard deviation of date</span>
<span class="sd">        confint : float</span>
<span class="sd">            Confidence interval at desired confidence level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">t207</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r207_206</span><span class="p">,</span> <span class="n">u238u235</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">conf</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">date</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">t207</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r207_206</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">r207_206_std</span><span class="p">)</span> <span class="o">-</span> <span class="n">date</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">conf</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">confint</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">sig</span><span class="p">)</span> <span class="o">-</span> <span class="n">date</span>
            <span class="k">return</span> <span class="n">date</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">confint</span></div>
</div>



<div class="viewcode-block" id="sk_pb">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.sk_pb">[docs]</a>
<span class="k">def</span> <span class="nf">sk_pb</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="mf">4.57e3</span><span class="p">,</span> <span class="n">t1</span><span class="o">=</span><span class="mf">3.7e3</span><span class="p">,</span> <span class="n">mu1</span><span class="o">=</span><span class="mf">7.19</span><span class="p">,</span> <span class="n">mu2</span><span class="o">=</span><span class="mf">9.74</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mf">9.307</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="mf">10.294</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Common lead model from `Stacey and Kramers (1975) &lt;https://doi.org/10.1016/0012-821X(75)90088-6&gt;`__.</span>

<span class="sd">    This model implements a two stage process for the evolution of common lead.</span>

<span class="sd">    For times before :math:`t_1 = 3.7` Ga, the following equations describe the temporal evolution of common lead:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \\begin{align}</span>
<span class="sd">            \\frac{^{206}\\text{Pb}}{^{204}\\text{Pb}}(t) &amp;= \\left(\\frac{^{206}\\text{Pb}}{^{204}\\text{Pb}}\\right)_0 + \\mu_1\\,\\left(e^{\\lambda_{238}t_0}-e^{\\lambda_{238}t}\\right) \\\\</span>
<span class="sd">            \\frac{^{207}\\text{Pb}}{^{204}\\text{Pb}}(t) &amp;= \\left(\\frac{^{207}\\text{Pb}}{^{204}\\text{Pb}}\\right)_0 + \\frac{^{235}\\text{U}}{^{238}\\text{U}} \\, \\mu_1\\, \\left(e^{\\lambda_{235}t_0}-e^{\\lambda_{235}t}\\right)</span>
<span class="sd">        \\end{align}</span>

<span class="sd">    For times after :math:`t_1 = 3.7` Ga, the following equations describe the temporal evolution of common lead:</span>

<span class="sd">    .. math::</span>
<span class="sd">            </span>
<span class="sd">        \\begin{align}</span>
<span class="sd">        \\frac{^{206}\\text{Pb}}{^{204}\\text{Pb}}(t) &amp;= \\left(\\frac{^{206}\\text{Pb}}{^{204}\\text{Pb}}\\right)_1 + \\mu_2\\,\\left(e^{\\lambda_{238}t_1}-e^{\\lambda_{238}t}\\right) \\\\</span>
<span class="sd">        \\frac{^{207}\\text{Pb}}{^{204}\\text{Pb}}(t) &amp;= \\left(\\frac{^{207}\\text{Pb}}{^{204}\\text{Pb}}\\right)_1 + \\frac{^{235}\\text{U}}{^{238}\\text{U}} \\, \\mu_2\\, \\left(e^{\\lambda_{235}t_1}-e^{\\lambda_{235}t}\\right)</span>
<span class="sd">        \\end{align}</span>

<span class="sd">    where :math:`\\left(\\frac{^{206}\\text{Pb}}{^{204}\\text{Pb}}\\right)_1` and :math:`\\left(\\frac{^{207}\\text{Pb}}{^{204}\\text{Pb}}\\right)_1` are the above equations evaluated at :math:`t=t_1`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : 1d array like</span>
<span class="sd">        Time(s) (in Ma) for which to return isotopic ratios for the linear mixing model from concordia to mantle</span>
<span class="sd">    t0 : float, optional</span>
<span class="sd">        Age of earth in Myr, by default 4570.</span>
<span class="sd">    t1 : float, optional</span>
<span class="sd">        Age of transition between model stages, by default 3700.</span>
<span class="sd">    mu1 : float, optional</span>

<span class="sd">    mu2 : float, optional</span>
<span class="sd">    x0 : float, optional</span>
<span class="sd">        206Pb/204Pb ratio for troilite lead, by default 9.307.</span>
<span class="sd">    y0 : float, optional</span>
<span class="sd">        207Pb/204Pb ratio for troilite lead, by default 10.294.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    r206_204 : 1d array</span>
<span class="sd">        206/204 ratio(s) for the given time(s)</span>
<span class="sd">    r207_204 : 1d array</span>
<span class="sd">        207/204 ratio(s) for the given time(s)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        import radage</span>
<span class="sd">        import numpy as np</span>
<span class="sd">        import matplotlib.pyplot as plt</span>
<span class="sd">        t = np.linspace(0, 4500, 50)</span>
<span class="sd">        r206_204, r207_204 = radage.sk_pb(t)</span>
<span class="sd">        plt.figure(figsize=(6, 4))</span>
<span class="sd">        plt.plot(r206_204, r207_204, linewidth=4)</span>
<span class="sd">        plt.grid()</span>
<span class="sd">        plt.xlabel(r&#39;${}^{206}\\mathrm{Pb}/{}^{204}\\mathrm{Pb}$&#39;)</span>
<span class="sd">        plt.ylabel(r&#39;${}^{207}\\mathrm{Pb}/{}^{204}\\mathrm{Pb}$&#39;)</span>
<span class="sd">        plt.title(&#39;Stacey and Kramers (1975) Common Lead Model&#39;)</span>
<span class="sd">        plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="p">]),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="c1"># output ratios</span>
    <span class="n">r206_204</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>  <span class="c1"># x(t)</span>
    <span class="n">r207_204</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>  <span class="c1"># y(t)</span>

    <span class="c1"># for times in first stage</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">t1</span>
    <span class="n">r206_204</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">mu1</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span>
    <span class="n">r207_204</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">mu1</span> <span class="o">/</span> <span class="n">u238u235</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t0</span><span class="p">)</span> <span class="o">-</span>
                                           <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span>

    <span class="c1"># for times in second stage</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">t1</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">mu1</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t1</span><span class="p">))</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">mu1</span> <span class="o">/</span> <span class="n">u238u235</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t1</span><span class="p">))</span>
    <span class="n">r206_204</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">mu2</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span>
    <span class="n">r207_204</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">mu2</span> <span class="o">/</span> <span class="n">u238u235</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t1</span><span class="p">)</span> <span class="o">-</span>
                                           <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">r206_204</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">r207_204</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span></div>



<div class="viewcode-block" id="Pb_mix_t">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.Pb_mix_t">[docs]</a>
<span class="k">def</span> <span class="nf">Pb_mix_t</span><span class="p">(</span><span class="n">r207_206</span><span class="p">,</span> <span class="n">r238_206</span><span class="p">,</span> <span class="n">Pbc</span><span class="o">=</span><span class="s1">&#39;SK&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Solve for age given a pair of 207/206 &amp; 238/206 isotopic ratios and a common lead model.</span>

<span class="sd">    Given a pair of 207/206 &amp; 238/206 isotopic ratios, this function solves for the age such that one has a lead mixing model that results in identical Stacey &amp; Kramers&#39; (1975) common lead model and lower intercept concordia ages while also passing through the observed pair of ratios.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r207_206 : float</span>
<span class="sd">        207/206 ratio</span>
<span class="sd">    r238_206 : float</span>
<span class="sd">        238/206 ratio</span>
<span class="sd">    Pbc : str or float, optional</span>
<span class="sd">        Initial common lead model to use, by default &#39;SK&#39;. If float, then the common lead model is defined by the input value.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    t : float</span>
<span class="sd">        Age in Myr</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        import radage</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">Pbc</span> <span class="o">==</span> <span class="s1">&#39;SK&#39;</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">Pbc0</span><span class="p">(</span><span class="n">t</span><span class="p">):</span> 
            <span class="n">r206_204</span><span class="p">,</span> <span class="n">r207_204</span> <span class="o">=</span> <span class="n">sk_pb</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">r207_206_0</span> <span class="o">=</span> <span class="n">r207_204</span> <span class="o">/</span> <span class="n">r206_204</span>
            <span class="k">return</span> <span class="n">r207_206_0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># check value is a float</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Pbc</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="s1">&#39;Pbc must be a float or &quot;SK&quot;&#39;</span>
        <span class="c1"># make sure value is greater than zero and less than 2</span>
        <span class="k">assert</span> <span class="n">Pbc</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">Pbc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Pbc must be between 0 and 2&#39;</span>
        <span class="k">def</span> <span class="nf">Pbc0</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="n">r207_206_0</span> <span class="o">=</span> <span class="n">Pbc</span>
            <span class="k">return</span> <span class="n">r207_206_0</span>

    <span class="k">def</span> <span class="nf">cost</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        defines a cost metric to search over appropriate times</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r207_206_0</span> <span class="o">=</span> <span class="n">Pbc0</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">r238_206_0</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># concordia (radiogenic component)</span>
        <span class="n">r238_206_rad</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">r207_206_rad</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">u238u235</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l235</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span>
                                       <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l238</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># compute distance from line connecting these two points</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">r238_206_rad</span><span class="o">-</span><span class="n">r238_206_0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">r207_206_0</span><span class="o">-</span><span class="n">r207_206</span><span class="p">)</span> <span class="o">-</span>
                   <span class="p">(</span><span class="n">r238_206_0</span><span class="o">-</span><span class="n">r238_206</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">r207_206_rad</span><span class="o">-</span><span class="n">r207_206_0</span><span class="p">))</span> <span class="o">/</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">r238_206_rad</span><span class="o">-</span><span class="n">r238_206_0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                    <span class="p">(</span><span class="n">r207_206_rad</span><span class="o">-</span><span class="n">r207_206_0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">d</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">minimize_scalar</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4500</span><span class="p">))</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>

    <span class="k">return</span> <span class="n">t</span></div>



<div class="viewcode-block" id="discordance_filter">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.discordance_filter">[docs]</a>
<span class="k">def</span> <span class="nf">discordance_filter</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span>
                       <span class="n">method</span><span class="o">=</span><span class="s1">&#39;concordia-distance&#39;</span><span class="p">,</span>
                       <span class="n">threshold</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span>
                       <span class="n">system_threshold</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    function to filter on discordance</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ages : list</span>
<span class="sd">        List of UPb.radage objects</span>
<span class="sd">    method : string</span>
<span class="sd">        &#39;relative&#39;, &#39;absolute&#39;, &#39;aitchison&#39;, &#39;concordia-distance&#39;, by default &#39;concordia-distance&#39;</span>
<span class="sd">        discordance metric to use. Discordance is evaluated between 207/206-238/206 ages for samples with 207/206 ages &gt; 1 Ga, and 206/238-207/235 ages for sample with 207/206 ages &lt; 1 Ga</span>
<span class="sd">    threshold : float, optional</span>
<span class="sd">        discordance value for chosen filtering method above which to flag ages as discordant</span>
<span class="sd">    system_threshold : boolean, optional</span>
<span class="sd">        whether or not to switch discordance metrics between the 207/206-238/206 and 206/238-207/235 systems at 1 Ga. If false, then discordance is always computed between the 207/206-238/206 systems. If true, only works for aitchison, relative, and absolute discordance metrics.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ages_conc : list</span>
<span class="sd">        List of UPb.radage objects that pass the discordance filter</span>
<span class="sd">    idx : np.ndarray</span>
<span class="sd">        Indices of the ages that pass the discordance filter</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ages_conc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ages</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;relative&#39;</span><span class="p">,</span> <span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="s1">&#39;aitchison&#39;</span><span class="p">,</span> <span class="s1">&#39;concordia-distance&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;method must be one of &quot;relative&quot;, &quot;absolute&quot;, &quot;aitchison&quot;, or &quot;concordia-distance&quot;&#39;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;concordia-distance&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">age</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ages</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">age</span><span class="o">.</span><span class="n">discordance</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="n">ages_conc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>
                <span class="n">idx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">system_threshold</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">age</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ages</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">age</span><span class="o">.</span><span class="n">date76</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                    <span class="n">cur_method</span> <span class="o">=</span> <span class="n">method</span> <span class="o">+</span> <span class="s1">&#39;_76_68&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cur_method</span> <span class="o">=</span> <span class="n">method</span> <span class="o">+</span> <span class="s1">&#39;_68_75&#39;</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">age</span><span class="o">.</span><span class="n">discordance</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">cur_method</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
                    <span class="n">ages_conc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>
                    <span class="n">idx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">age</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ages</span><span class="p">):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">age</span><span class="o">.</span><span class="n">discordance</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span> <span class="o">+</span> <span class="s1">&#39;_76_68&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
                    <span class="n">ages_conc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>
                    <span class="n">idx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    
    <span class="k">return</span> <span class="n">ages_conc</span><span class="p">,</span> <span class="n">idx</span></div>



<div class="viewcode-block" id="root_fun_76_86">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.root_fun_76_86">[docs]</a>
<span class="k">def</span> <span class="nf">root_fun_76_86</span><span class="p">(</span><span class="n">r238_206</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Root function for finding the lower intercept date in Tera-Wasserburg space</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r238_206 : float</span>
<span class="sd">        238/206 ratio</span>
<span class="sd">    m : float</span>
<span class="sd">        Slope of the line in Tera-Wasserburg space</span>
<span class="sd">    b : float</span>
<span class="sd">        Intercept of the line in Tera-Wasserburg space</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    r207_206_conc - r207_206_disc : float</span>
<span class="sd">        Difference between the concordia and discordia ratios</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r207_206_conc</span> <span class="o">=</span> <span class="n">concordia_tw</span><span class="p">(</span><span class="n">t238</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">r238_206</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">r207_206_disc</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">r238_206</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">r207_206_conc</span> <span class="o">-</span> <span class="n">r207_206_disc</span></div>


<div class="viewcode-block" id="discordia_date_76_86">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.discordia_date_76_86">[docs]</a>
<span class="k">def</span> <span class="nf">discordia_date_76_86</span><span class="p">(</span><span class="n">UPbs</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_mc</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">Pbc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Pbc_std</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lower intercept date in Tera-Wasserburg space</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    UPbs : list</span>
<span class="sd">        List of UPb.radage objects</span>
<span class="sd">    conf : float, optional</span>
<span class="sd">        Confidence level for interval, by default None. If None, only the lower intercept date is returned. Otherwise, a range corresponding to the confidence level is returned.</span>
<span class="sd">        Valid values are between 0 and 1.</span>
<span class="sd">    n_mc : int, optional</span>
<span class="sd">        Number of Monte Carlo iterations to use for estimating uncertainty, by default 1000. This is only used if conf is not None.</span>
<span class="sd">    Pbc : float, optional</span>
<span class="sd">        Common lead ratio to use, by default None. If None, the common lead ratio is estimated from the data. If a float, the common lead ratio is fixed to this value. If &#39;SK&#39;, the common lead ratio is determined such that it is equal to the Stacey and Kramers (1975) common lead ratio at the lower intercept date.</span>
<span class="sd">    Pbc_std : float, optional</span>
<span class="sd">        Standard deviation of the common lead ratio, by default 1e-1. This is only used if conf is not None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        Dictionary containing the following:</span>

<span class="sd">        - date : float</span>
<span class="sd">            Date in Ma corresponding to the lower intercept of the line in Tera-Wasserburg space.</span>
<span class="sd">        - slope : float</span>
<span class="sd">            Slope of the line in Tera-Wasserburg space.</span>
<span class="sd">        - slope_std : float</span>
<span class="sd">            Standard deviation of the slope.</span>
<span class="sd">        - intercept : float</span>
<span class="sd">            Common lead ratio determined in the calculation. Returns same value as input if Pbc is a float.</span>
<span class="sd">        - intercept_std : float</span>
<span class="sd">            Standard deviation of the common lead ratio.</span>
<span class="sd">        - slope_intercept_cov : float</span>
<span class="sd">            Covariance between the slope and intercept.</span>
<span class="sd">        - mswd : float</span>
<span class="sd">            Mean square weighted deviation of the fit.</span>
<span class="sd">        - confint : list</span>
<span class="sd">            List of lower and upper bounds of the confidence interval for the lower intercept date. This is only computed if conf is not None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># gather relevant ratios</span>
    <span class="n">r238_206</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">r238_206</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">UPbs</span><span class="p">])</span>
    <span class="n">r238_206_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">r238_206_std</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">UPbs</span><span class="p">])</span>
    <span class="n">r207_206</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">r207_206</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">UPbs</span><span class="p">])</span>
    <span class="n">r207_206_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">r207_206_std</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">UPbs</span><span class="p">])</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">rho86_76</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">UPbs</span><span class="p">])</span>

    <span class="c1"># helper function to append fixed common lead ratios to the data</span>
    <span class="k">def</span> <span class="nf">Pbc_append</span><span class="p">(</span><span class="n">Pbc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Append common lead ratio to the data&quot;&quot;&quot;</span>
        <span class="n">r238_206_app</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r238_206</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">r238_206_std_app</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r238_206_std</span><span class="p">,</span> <span class="mf">1e-10</span><span class="p">)</span>
        <span class="n">r207_206_app</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r207_206</span><span class="p">,</span> <span class="n">Pbc</span><span class="p">)</span>
        <span class="n">r207_206_std_app</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r207_206_std</span><span class="p">,</span> <span class="n">Pbc_std</span><span class="p">)</span>
        <span class="n">rho_app</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r238_206_app</span><span class="p">,</span> <span class="n">r238_206_std_app</span><span class="p">,</span> <span class="n">r207_206_app</span><span class="p">,</span> <span class="n">r207_206_std_app</span><span class="p">,</span> <span class="n">rho_app</span>

    <span class="c1"># if anchoring to a common lead ratio, append it to the data</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Pbc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">Pbc</span> <span class="o">!=</span> <span class="s1">&#39;SK&#39;</span><span class="p">):</span>
        <span class="c1"># make sure value is greater than zero and less than 2</span>
        <span class="k">assert</span> <span class="n">Pbc</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">Pbc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Pbc must be between 0 and 2&#39;</span>
        <span class="c1"># append common lead ratio to the data</span>
        <span class="n">r238_206_fit</span><span class="p">,</span> <span class="n">r238_206_std_fit</span><span class="p">,</span> <span class="n">r207_206_fit</span><span class="p">,</span> <span class="n">r207_206_std_fit</span><span class="p">,</span> <span class="n">rho_fit</span> <span class="o">=</span> <span class="n">Pbc_append</span><span class="p">(</span><span class="n">Pbc</span><span class="p">)</span>
    <span class="c1"># if using SK, solve for slope and intercept such that the common lead ratio is equal to the Stacey and Kramers (1975) common lead ratio at the lower intercept date</span>
    <span class="k">elif</span> <span class="n">Pbc</span> <span class="o">==</span> <span class="s1">&#39;SK&#39;</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">cost</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Cost function for finding optimal t that fits data and common lead model&quot;&quot;&quot;</span>
            <span class="n">r206_204</span><span class="p">,</span> <span class="n">r207_204</span> <span class="o">=</span> <span class="n">sk_pb</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">Pbc</span> <span class="o">=</span> <span class="n">r207_204</span> <span class="o">/</span> <span class="n">r206_204</span>
            <span class="n">r238_206_ctw</span><span class="p">,</span> <span class="n">r207_206_ctw</span> <span class="o">=</span> <span class="n">concordia_tw</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">r207_206_ctw</span> <span class="o">-</span> <span class="n">Pbc</span><span class="p">)</span> <span class="o">/</span> <span class="n">r238_206_ctw</span>

            <span class="c1"># don&#39;t include fixed point in the fit</span>
            <span class="n">mswd</span> <span class="o">=</span> <span class="n">line_mswd</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Pbc</span><span class="p">,</span> <span class="n">r238_206</span><span class="p">,</span> <span class="n">r207_206</span><span class="p">,</span>
                             <span class="mi">1</span><span class="o">/</span><span class="n">r238_206_std</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">r207_206_std</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>

            <span class="c1"># but t needs to match lower intercept date</span>
            <span class="k">return</span> <span class="n">mswd</span>
        <span class="c1"># find optimal t that fits data and common lead model</span>
        <span class="n">t_opt</span> <span class="o">=</span> <span class="n">minimize_scalar</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5000</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bounded&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">x</span>
        <span class="n">Pbc</span> <span class="o">=</span> <span class="n">sk_pb</span><span class="p">(</span><span class="n">t_opt</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">sk_pb</span><span class="p">(</span><span class="n">t_opt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># append Pbc at t_opt to the data</span>
        <span class="n">r238_206_fit</span><span class="p">,</span> <span class="n">r238_206_std_fit</span><span class="p">,</span> <span class="n">r207_206_fit</span><span class="p">,</span> <span class="n">r207_206_std_fit</span><span class="p">,</span> <span class="n">rho_fit</span> <span class="o">=</span> <span class="n">Pbc_append</span><span class="p">(</span><span class="n">Pbc</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r238_206_fit</span><span class="p">,</span> <span class="n">r238_206_std_fit</span><span class="p">,</span> <span class="n">r207_206_fit</span><span class="p">,</span> <span class="n">r207_206_std_fit</span><span class="p">,</span> <span class="n">rho_fit</span> <span class="o">=</span> <span class="n">r238_206</span><span class="p">,</span> <span class="n">r238_206_std</span><span class="p">,</span> <span class="n">r207_206</span><span class="p">,</span> <span class="n">r207_206_std</span><span class="p">,</span> <span class="n">rho</span>

    <span class="c1"># compute slope and intercept of line in Tera-Wasserburg space</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">m_sig</span><span class="p">,</span> <span class="n">b_sig</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">mb_cov</span> <span class="o">=</span> <span class="n">yorkfit</span><span class="p">(</span><span class="n">r238_206_fit</span><span class="p">,</span> 
                                    <span class="n">r207_206_fit</span><span class="p">,</span>
                                    <span class="mi">1</span><span class="o">/</span><span class="n">r238_206_std_fit</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                                    <span class="mi">1</span><span class="o">/</span><span class="n">r207_206_std_fit</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> 
                                    <span class="n">rho_fit</span><span class="p">)</span>
    <span class="c1"># compute MSWD using just input data</span>
    <span class="n">mswd</span> <span class="o">=</span> <span class="n">line_mswd</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r238_206</span><span class="p">,</span> <span class="n">r207_206</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">r238_206_std</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">r207_206_std</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>


    <span class="c1"># find root</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># initial 238/206 for root finding</span>
    <span class="k">if</span> <span class="n">conf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mod_mc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">m_sig</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">mb_cov</span><span class="p">],</span> <span class="p">[</span><span class="n">mb_cov</span><span class="p">,</span> <span class="n">b_sig</span><span class="o">**</span><span class="mi">2</span><span class="p">]])),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_mc</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">m</span><span class="p">],</span> <span class="p">[</span><span class="n">b</span><span class="p">]])</span>
        <span class="n">m_mc</span> <span class="o">=</span> <span class="n">mod_mc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">b_mc</span> <span class="o">=</span> <span class="n">mod_mc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_mc</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mc</span><span class="p">):</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="n">root_scalar</span><span class="p">(</span><span class="n">root_fun_76_86</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">m_mc</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">b_mc</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span> <span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;newton&#39;</span><span class="p">)</span>
            <span class="n">dates</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">t238</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">sol</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="n">confint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="p">[(</span><span class="mi">1</span><span class="o">-</span><span class="n">conf</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">conf</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">root_scalar</span><span class="p">(</span><span class="n">root_fun_76_86</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;newton&#39;</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">t238</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">sol</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="n">confint</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span> 
              <span class="s1">&#39;slope&#39;</span><span class="p">:</span> <span class="n">m</span><span class="p">,</span>
              <span class="s1">&#39;slope_sig&#39;</span><span class="p">:</span> <span class="n">m_sig</span><span class="p">,</span>
              <span class="s1">&#39;intercept&#39;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> 
              <span class="s1">&#39;intercept_sig&#39;</span><span class="p">:</span> <span class="n">b_sig</span><span class="p">,</span> 
              <span class="s1">&#39;slope_intercept_cov&#39;</span><span class="p">:</span> <span class="n">mb_cov</span><span class="p">,</span>
              <span class="s1">&#39;x_bar&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">r238_206</span><span class="p">),</span>
              <span class="s1">&#39;mswd&#39;</span><span class="p">:</span> <span class="n">mswd</span><span class="p">,</span>
              <span class="s1">&#39;confint&#39;</span><span class="p">:</span> <span class="n">confint</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="wc1_corr">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.wc1_corr">[docs]</a>
<span class="k">def</span> <span class="nf">wc1_corr</span><span class="p">(</span><span class="n">wc1_UPbs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Correct 238/206 ratios of WC1 analyses to achieve lower intercept age of 254 Ma with fixed common Pb 207/206 ratio of 0.85.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wc1_UPbs : list</span>
<span class="sd">        List of UPb.radage objects for WC1 analyses</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    factor: float</span>
<span class="sd">        Factor by which to multiply 238/206 ratios to achieve lower intercept age of 254 Ma with fixed common Pb 207/206 ratio of 0.85.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># compute slope with fixed common lead ratio of 0.85</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mf">0.85</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">discordia_date_76_86</span><span class="p">(</span><span class="n">wc1_UPbs</span><span class="p">,</span> <span class="n">Pbc</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;slope&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">cost</span><span class="p">(</span><span class="n">factor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cost function for finding factor to multiply 238/206 ratios by&quot;&quot;&quot;</span>
        <span class="c1"># compute lower intercept date</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">root_scalar</span><span class="p">(</span><span class="n">root_fun_76_86</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">factor</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">x0</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;newton&#39;</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">t238</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">sol</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">date</span> <span class="o">-</span> <span class="mi">254</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="c1"># find factor that minimizes cost function</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="n">minimize_scalar</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bounded&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">x</span>

    <span class="k">return</span> <span class="n">factor</span></div>



<div class="viewcode-block" id="kde">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.kde">[docs]</a>
<span class="k">def</span> <span class="nf">kde</span><span class="p">(</span><span class="n">radages</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span>
        <span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;gauss&#39;</span><span class="p">,</span>
        <span class="n">bw</span><span class="o">=</span><span class="s1">&#39;adaptive&#39;</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;uncertainty&#39;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate kde for radages at times t. </span>
<span class="sd">    </span>
<span class="sd">    The 238/206 - 207/206 concordia ages are used for plotting, and the associated uncertainties are used as weights.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    radages : arraylike</span>
<span class="sd">        list of radages.</span>
<span class="sd">    t : arraylike</span>
<span class="sd">        times at which to evaluate the kde.</span>
<span class="sd">    bw : str or float, optional</span>
<span class="sd">        Bandwidth, by default &#39;adaptive&#39;. Valid strings are &#39;adaptive&#39;, &#39;scott&#39;, &#39;botev&#39;. If float, specifies a fixed bandwidth directly.</span>
<span class="sd">    kernel : str, optional</span>
<span class="sd">        Kernel function to use, by default &#39;epa&#39;. Valid strings are &#39;epa&#39;, &#39;gauss&#39;.</span>
<span class="sd">    weights : arraylike or None or str, optional</span>
<span class="sd">        Weights for each age, by default &#39;uncertainty&#39;. Valid values are &#39;uncertainty&#39;, None, or an array of floats of the same length as radages.</span>
<span class="sd">    **kwargs : dict, optional</span>
<span class="sd">        Additional arguments to pass to helper.kde_base</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    kde_est : arraylike</span>
<span class="sd">        KDE estimate at times t</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># compute concordia ages</span>
    <span class="n">dates_conc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">age</span><span class="o">.</span><span class="n">date_207_238_concordia</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">age</span> <span class="ow">in</span> <span class="n">radages</span><span class="p">])</span>
    <span class="n">ages_in</span> <span class="o">=</span> <span class="n">dates_conc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ages_in</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">weights</span> <span class="o">==</span> <span class="s1">&#39;uncertainty&#39;</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">dates_conc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ages_in</span><span class="p">),</span> <span class="s1">&#39;Weights must be the same length as radages&#39;</span>

    <span class="c1"># evaluate kde</span>
    <span class="n">kde_est</span> <span class="o">=</span> <span class="n">kde_base</span><span class="p">(</span><span class="n">ages_in</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">bw</span><span class="o">=</span><span class="n">bw</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">kde_est</span></div>



<div class="viewcode-block" id="line_mswd">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.line_mswd">[docs]</a>
<span class="k">def</span> <span class="nf">line_mswd</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reduced chi-squared statistic for a linear fit to data with errors in both x and y.</span>
<span class="sd">    This</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : float</span>
<span class="sd">        Slope of line</span>
<span class="sd">    b : float</span>
<span class="sd">        Intercept of line</span>
<span class="sd">    x : array-like</span>
<span class="sd">        x-values</span>
<span class="sd">    y : array-like</span>
<span class="sd">        y-values</span>
<span class="sd">    wx : array-like</span>
<span class="sd">        Weights for x-values (typically 1/sigma^2)</span>
<span class="sd">    wy : array-like</span>
<span class="sd">        Weights for y-values (typically 1/sigma^2)</span>
<span class="sd">    r : array-like</span>
<span class="sd">        Correlation coefficients of errors in x and y, must be between -1 and 1</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mswd : float</span>
<span class="sd">        Reduced chi-squared statistic for residuals with respect to the line</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># for variable meanings, see yorkfit()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="s1">&#39;x and y must be the same length&#39;</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">wx</span> <span class="o">*</span> <span class="n">wy</span><span class="p">)</span>
    <span class="n">W</span> <span class="o">=</span> <span class="p">(</span><span class="n">wx</span> <span class="o">*</span> <span class="n">wy</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">wx</span> <span class="o">+</span> <span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">wy</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="n">mswd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">W</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">m</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mswd</span></div>


<div class="viewcode-block" id="yorkfit">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.yorkfit">[docs]</a>
<span class="k">def</span> <span class="nf">yorkfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">thres</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of York 1969 10.1016/S0012-821X(68)80059-7</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array-like </span>
<span class="sd">        Mean x-values</span>
<span class="sd">    y : array-like</span>
<span class="sd">        Mean y-values</span>
<span class="sd">    wx : array-like</span>
<span class="sd">        Weights for x-values (typically 1/sigma^2)</span>
<span class="sd">    wy : array-like </span>
<span class="sd">        Weights for y-values (typically 1/sigma^2)</span>
<span class="sd">    r : array-like</span>
<span class="sd">        Correlation coefficients of errors in x and y, must be between -1 and 1</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    b : float</span>
<span class="sd">        Maximum likelihood estimate for slope of line</span>
<span class="sd">    a : float </span>
<span class="sd">        Maximum likelihood estimate for intercept of line</span>
<span class="sd">    b_sig : float</span>
<span class="sd">        Standard deviation of slope for line</span>
<span class="sd">    a_sig : float</span>
<span class="sd">        Standard deviation of intercept for line</span>
<span class="sd">    mswd : float</span>
<span class="sd">        Reduced chi-squared statistic for residuals with respect to the maximum likelihood linear model</span>
<span class="sd">    ab_cov : float</span>
<span class="sd">        Covariance of slope and intercept for line</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="s1">&#39;x and y must be the same length&#39;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">wx</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;wx must be the same length as x&#39;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">wy</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="s1">&#39;wy must be the same length as y&#39;</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;r must be between -1 and 1&#39;</span>
    
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="c1"># get first guess for b</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># initialize various quantities</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">wx</span> <span class="o">*</span> <span class="n">wy</span><span class="p">)</span>

    <span class="c1"># now iterate as per manuscript to improve b</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">thres</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count_thres</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">delta</span> <span class="o">&gt;</span> <span class="n">thres</span><span class="p">)</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">count_thres</span><span class="p">:</span>
        <span class="c1"># update values from current value of b</span>
        <span class="n">W</span> <span class="o">=</span> <span class="p">(</span><span class="n">wx</span> <span class="o">*</span> <span class="n">wy</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">wx</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">wy</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">xbar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">W</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
        <span class="n">ybar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">W</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">xbar</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">ybar</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">W</span> <span class="o">*</span> <span class="p">(</span><span class="n">U</span> <span class="o">/</span> <span class="n">wy</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">V</span> <span class="o">/</span> <span class="n">wx</span> <span class="o">-</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">U</span> <span class="o">+</span> <span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span> <span class="o">/</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="c1"># update b</span>
        <span class="n">b_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">W</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">V</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">W</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">U</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">b_new</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b_new</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># compute a</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">ybar</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">xbar</span>
    <span class="c1"># compute adjusted x, y</span>
    <span class="n">x_adj</span> <span class="o">=</span> <span class="n">xbar</span> <span class="o">+</span> <span class="n">beta</span>
    <span class="n">x_adj_bar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">W</span> <span class="o">*</span> <span class="n">x_adj</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">x_adj</span> <span class="o">-</span> <span class="n">x_adj_bar</span>
    <span class="c1"># compute parameter uncertainties</span>
    <span class="n">b_sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">W</span> <span class="o">*</span> <span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">a_sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_adj_bar</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b_sig</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ab_cov</span> <span class="o">=</span> <span class="o">-</span><span class="n">x_adj_bar</span> <span class="o">*</span> <span class="n">b_sig</span><span class="o">**</span><span class="mi">2</span>
    <span class="c1"># compute goodness of fit (reduced chi-squared statistic)</span>
    <span class="n">mswd</span> <span class="o">=</span> <span class="n">line_mswd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b_sig</span><span class="p">,</span> <span class="n">a_sig</span><span class="p">,</span> <span class="n">mswd</span><span class="p">,</span> <span class="n">ab_cov</span></div>



<div class="viewcode-block" id="weighted_mean">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.weighted_mean">[docs]</a>
<span class="k">def</span> <span class="nf">weighted_mean</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="n">ages_s</span><span class="p">,</span> <span class="n">sig_method</span><span class="o">=</span><span class="s1">&#39;naive&#39;</span><span class="p">,</span> <span class="n">standard_error</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Weighted-mean age computation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ages : array-like</span>
<span class="sd">        Age means</span>
<span class="sd">    ages_s : array-like</span>
<span class="sd">        Age standard deviations (same length as ages)</span>
<span class="sd">    sig_method : str, optional</span>
<span class="sd">        Method for computing the standard error of the weighted mean, by default &#39;naive&#39;. Valid strings are &#39;naive&#39;, &#39;unbiased&#39;</span>
<span class="sd">        For unbiased, see </span>
<span class="sd">            https://en.wikipedia.org/wiki/Weighted_arithmetic_mean#Reliability_weights,</span>
<span class="sd">            https://seismo.berkeley.edu/~kirchner/Toolkits/Toolkit_12.pdf </span>
<span class="sd">    standard_error : bool, optional</span>
<span class="sd">        Whether to return the standard error of the weighted mean, by default True. If sig_method is &#39;naive&#39;, then this parameter is True.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mu : float</span>
<span class="sd">        Weighted mean age</span>
<span class="sd">    sig : float</span>
<span class="sd">        Standard deviation or error of weighted mean age, depending on standard_error value</span>
<span class="sd">    mswd : float</span>
<span class="sd">        Reduced chi-squared statistic for residuals with respect to the weighted mean</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># weights</span>
    <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">ages_s</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># weighted mean</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ages</span><span class="o">*</span><span class="n">w</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="c1"># verify sig_method is valid</span>
    <span class="k">assert</span> <span class="n">sig_method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;naive&#39;</span><span class="p">,</span> <span class="s1">&#39;unbiased&#39;</span><span class="p">,</span> <span class="s1">&#39;biased&#39;</span><span class="p">],</span> <span class="s1">&#39;sig_method must be one of naive, unbiased, biased&#39;</span>
    <span class="c1"># ignore standard error if sig_method is naive</span>
    <span class="k">if</span> <span class="n">sig_method</span> <span class="o">==</span> <span class="s1">&#39;naive&#39;</span><span class="p">:</span>
        <span class="n">standard_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># naive</span>
    <span class="k">if</span> <span class="n">sig_method</span> <span class="o">==</span> <span class="s1">&#39;naive&#39;</span><span class="p">:</span>
        <span class="n">sig2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># hacky</span>
    <span class="c1"># unbiased</span>
    <span class="k">elif</span> <span class="n">sig_method</span> <span class="o">==</span> <span class="s1">&#39;unbiased&#39;</span><span class="p">:</span>
        <span class="n">sig2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">ages</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>   <span class="c1"># effective sample size</span>
    <span class="c1"># biased</span>
    <span class="k">elif</span> <span class="n">sig_method</span> <span class="o">==</span> <span class="s1">&#39;biased&#39;</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ages</span><span class="p">)</span>   <span class="c1"># sample size</span>
        <span class="n">sig2</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">ages</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">standard_error</span><span class="p">:</span>
       <span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sig2</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sig2</span><span class="p">)</span>

    <span class="n">mswd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">ages</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">ages_s</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">mswd</span></div>



<div class="viewcode-block" id="get_ages">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.get_ages">[docs]</a>
<span class="k">def</span> <span class="nf">get_ages</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Produce UPb age objects</span>

<span class="sd">    Create UPb age objects from data in GeochemDB. This function assumes that the following quantities are present in the GeochemDB database and form columns in the input DataFrame:</span>
<span class="sd">    - Pb206/U238</span>
<span class="sd">    - Pb207/U235</span>
<span class="sd">    - Pb207/Pb206</span>
<span class="sd">    - rho 206Pb/238U v 207Pb/235U</span>
<span class="sd">    - rho 207Pb/206Pb v 238U/206Pb</span>
<span class="sd">    These quantitues should have both mean and uncertainty values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        DataFrame of U-Pb measurements, ideally from GeochemDB.GeochemDB.measurements_by_sample(). Must have a hierarchical column index with the following levels: &#39;Pb206/U238&#39;, &#39;Pb207/U235&#39;, &#39;Pb207/Pb206&#39;, &#39;rho 206Pb/238U v 207Pb/235U&#39;, &#39;rho 207Pb/206Pb v 238U/206Pb&#39;. Each level should have &#39;mean&#39; and &#39;uncertainty&#39; sublevels. </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ages : list</span>
<span class="sd">        List of UPb objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># cols</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Pb206/U238&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span> 
            <span class="p">(</span><span class="s1">&#39;Pb206/U238&#39;</span><span class="p">,</span> <span class="s1">&#39;uncertainty&#39;</span><span class="p">),</span> 
            <span class="p">(</span><span class="s1">&#39;Pb207/U235&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;Pb207/U235&#39;</span><span class="p">,</span> <span class="s1">&#39;uncertainty&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;Pb207/Pb206&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;Pb207/Pb206&#39;</span><span class="p">,</span> <span class="s1">&#39;uncertainty&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;rho 206Pb/238U v 207Pb/235U&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;rho 207Pb/206Pb v 238U/206Pb&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">)]</span>
    
    <span class="n">ages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">ages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">UPb</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> 
                              <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">cols</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                              <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">cols</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> 
                              <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">cols</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> 
                              <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">cols</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span> 
                              <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">cols</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> 
                              <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">cols</span><span class="p">[</span><span class="mi">6</span><span class="p">]],</span>
                              <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">cols</span><span class="p">[</span><span class="mi">7</span><span class="p">]],</span> <span class="n">name</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">ages</span></div>



<span class="c1">###</span>
<span class="c1">### HAFNIUM</span>
<span class="c1">###</span>

<span class="c1"># Vervoort et al. 2018 values</span>
<span class="n">Lu_DM</span> <span class="o">=</span> <span class="mf">0.03976</span> 
<span class="n">Hf_DM</span> <span class="o">=</span> <span class="mf">0.283238</span>

<span class="c1"># Hf_DM = 0.283225</span>
<span class="c1"># Lu_DM = 0.0383</span>

<span class="c1"># Vervoort &amp; Blichert-Toft 1999</span>
<span class="n">Hf_CHUR</span> <span class="o">=</span> <span class="mf">0.282772</span>
<span class="n">Lu_CHUR</span> <span class="o">=</span> <span class="mf">0.0332</span>

<span class="n">lam_Lu</span> <span class="o">=</span> <span class="mf">1.867e-5</span> <span class="c1"># My-1</span>

<div class="viewcode-block" id="eHf">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.eHf">[docs]</a>
<span class="k">def</span> <span class="nf">eHf</span><span class="p">(</span><span class="n">Hf176Hf177</span><span class="p">,</span> <span class="n">Lu176Hf177</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">Hf_CHUR</span><span class="o">=</span><span class="n">Hf_CHUR</span><span class="p">,</span> <span class="n">Lu_CHUR</span><span class="o">=</span><span class="n">Lu_CHUR</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;epsilon hafnium </span>
<span class="sd">    </span>
<span class="sd">    for a given set of ratios</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Hf176Hf177 : array-like</span>
<span class="sd">        176Hf/177Hf ratio(s)</span>
<span class="sd">    Lu176Hf177 : array-like</span>
<span class="sd">        176Lu/177Hf ratio(s)</span>
<span class="sd">    t : array-like </span>
<span class="sd">        age(s) in Myr. If float, then the same age is used for all ratios.</span>
<span class="sd">    Hf_CHUR : float, optional</span>
<span class="sd">        176Hf/177Hf ratio for CHUR, by default Hf_CHUR</span>
<span class="sd">    Lu_CHUR : float, optional</span>
<span class="sd">        176Lu/177Hf ratio for CHUR, by default Lu_CHUR</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    eHf : array-like</span>
<span class="sd">        epsilon hafnium value(s)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">10000</span><span class="o">*</span><span class="p">((</span><span class="n">Hf176Hf177</span> <span class="o">-</span> <span class="n">Lu176Hf177</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lam_Lu</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> \
                  <span class="p">(</span><span class="n">Hf_CHUR</span> <span class="o">-</span> <span class="n">Lu_CHUR</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lam_Lu</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span></div>

                  
<div class="viewcode-block" id="eHf_DM">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.eHf_DM">[docs]</a>
<span class="k">def</span> <span class="nf">eHf_DM</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;epsilon Hafnium for depleted mantle</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : array-like</span>
<span class="sd">        Age(s) in Myr</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    eHf : array-like</span>
<span class="sd">        epsilon hafnium value(s) for depleted mantle</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">eHf</span><span class="p">(</span><span class="n">Hf_DM</span><span class="p">,</span> <span class="n">Lu_DM</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span></div>


<span class="c1">#</span>
<span class="c1"># DETRITAL AGE SPECTRA</span>
<span class="c1">#</span>
<div class="viewcode-block" id="DetritalSpectra">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.DetritalSpectra">[docs]</a>
<span class="k">class</span> <span class="nc">DetritalSpectra</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for gathering and analyzing detrital age spectra from geologic sources.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ages : dict or pandas.DataFrame</span>
<span class="sd">        Dictionary or DataFrame of ages. If dict, keys are sample names and values are lists of UPb.radage objects. If DataFrame, must have a column called &#39;UPb&#39; and a column called &#39;Sample&#39;, and the rows correspond to individual ages.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ages</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Instantiate DetritalSpectra object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ages : dict or pandas.DataFrame</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If ages is not a dict or pandas DataFrame</span>
<span class="sd">        AssertionError</span>
<span class="sd">            If ages is a DataFrame and does not have the required columns</span>
<span class="sd">        AssertionError</span>
<span class="sd">            If any of the ages are not UPb objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># process ages</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ages</span> <span class="o">=</span> <span class="n">ages</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">assert</span> <span class="s1">&#39;UPb&#39;</span> <span class="ow">in</span> <span class="n">ages</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;DataFrame must have a column called &quot;UPb&quot;&#39;</span>
            <span class="k">assert</span> <span class="s1">&#39;Sample&#39;</span> <span class="ow">in</span> <span class="n">ages</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;DataFrame must have a column called &quot;Sample&quot;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ages</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">ages</span><span class="p">[</span><span class="s1">&#39;Sample&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ages</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ages</span><span class="p">[</span><span class="n">ages</span><span class="p">[</span><span class="s1">&#39;Sample&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample</span><span class="p">][</span><span class="s1">&#39;UPb&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;ages must be a dict or pandas DataFrame&#39;</span><span class="p">)</span>
        <span class="c1"># validate UPb objects</span>
        <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ages</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">age</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ages</span><span class="p">[</span><span class="n">sample</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">UPb</span><span class="p">),</span> <span class="s1">&#39;All ages must be UPb objects&#39;</span>
        
<div class="viewcode-block" id="DetritalSpectra.dissimilarity">
<a class="viewcode-back" href="../../api/radage.radage.html#radage.radage.DetritalSpectra.dissimilarity">[docs]</a>
    <span class="k">def</span> <span class="nf">dissimilarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;wasserstein&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute dissimilarity matrix between detrital age spectra.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        method : str, optional</span>
<span class="sd">            Method to compute pairwise spectra dissimilarities, by default &#39;wasserstein&#39;. Valid methods are &#39;wasserstein&#39;, &#39;ks&#39;, &#39;energy&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        D : pd.DataFrame</span>
<span class="sd">            DataFrame of pairwise dissimilarities between detrital age spectra.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># validate method</span>
        <span class="k">assert</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;wasserstein&#39;</span><span class="p">,</span> <span class="s1">&#39;ks&#39;</span><span class="p">,</span> <span class="s1">&#39;energy&#39;</span><span class="p">],</span> <span class="s1">&#39;method must be one of &quot;wasserstein&quot;, &quot;ks&quot;, &quot;energy&quot;&#39;</span>

        <span class="c1"># prepare output dataframe</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ages</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">n_sam</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_sam</span><span class="p">,</span> <span class="n">n_sam</span><span class="p">)))</span>

        <span class="c1"># Wasserstein distance</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;wasserstein&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_sam</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_sam</span><span class="p">):</span>
                    <span class="c1"># get current pair of samples</span>
                    <span class="n">idx_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ages</span><span class="p">[</span><span class="n">samples</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="o">==</span> <span class="n">samples</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                    <span class="n">cur_sam_1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_1</span><span class="p">][</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span>
                    <span class="n">idx_2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Sample&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">samples</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
                    <span class="n">cur_sam_2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_2</span><span class="p">][</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span>
            
                    <span class="c1"># compute distance for pair</span>
                    <span class="n">wasser</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">wasserstein_distance</span><span class="p">(</span><span class="n">cur_sam_1</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">cur_sam_2</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                    <span class="n">wasser</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">wasser</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">D</span></div>
</div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Adrian Tasistro-Hart
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=3f1b9271"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>